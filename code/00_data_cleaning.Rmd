---
title: "Data Cleaning"
author: Casey Breen
---

Clean original data for the network survival portion of the study was provided from Reach Initatives. These network survival data were organized into two separate files: 

* Survey dataframe, an individual-level dataframe capturing all survey respondents 
* Death dataframe, a death-level dataframe with detailed info on each specific death 


```{r}
## read in packages 
library(tidyverse)
library(data.table)
library(gt)
library(janitor)
library(here)

## read in data 
survey_df <- readxl::read_xlsx(path = here("data/raw_data/2023-09-08/network_survey_2023-08-16.xlsx"), sheet = "main_networksurvival")
death_df <- readxl::read_xlsx(here("data/raw_data/2023-09-08/network_survey_2023-08-16.xlsx"), sheet = "deaths")
```


For pre-registration - count missing data 


```{r}
## People who did not give consent 
survey_df %>% 
  filter(consent != "yes")

## drop two with missing household or neighbor (Drop, N = 2)
survey_df %>% 
  filter(consent == "yes") %>% 
  filter(is.na(num_total_hh_neighbour))

## total number of kin (Drop, N = 18)
survey_df %>% 
  filter(consent == "yes") %>% 
  filter(is.na(num_total_kin))

## Drop missing values 
survey_df_clean <- survey_df %>% 
  filter(consent == "yes") %>% 
  filter(!is.na(num_total_hh_neighbour)) %>% 
  filter(!is.na(num_total_kin))

## recode and create new vars 
survey_df_clean <- survey_df_clean %>% 
  mutate(start_month = lubridate::floor_date(x = as_date(start), unit = "month"))
```

## Clean list of deaths 

```{r}
## death df (No missingness)
death_df %>% 
  filter(is.na(death_relationship))

## drop deaths without valid date (Drop, N = 5) 
death_df_clean <- death_df %>% 
  filter(!date_join_final_death %in% c(44927, 45061, 44928, 44951, 45030))

## rename variables abd create death month variable
death_df_clean <- death_df_clean %>% 
  mutate(uuid_ki = uuid_ki4) %>% 
  mutate(zone_de_sante_name = case_when(
      death_zs == 746101 ~ "Kalemie",           
      death_zs == 746601 ~ "Nyunzu",            
      death_zs == 746102 ~ "Nyemba")) %>% 
  mutate(death_month = lubridate::floor_date(x = as_date(date_join_final_death), unit = "month")) 
```

## write out files 
```{r}
## write out csv files 
write_csv(survey_df_clean, here("data/clean_data/survey_df_cleaned_dec3_2023.csv"))
write_csv(death_df_clean, here("data/clean_data/death_df_cleaned_dec3_2023.csv"))
```

